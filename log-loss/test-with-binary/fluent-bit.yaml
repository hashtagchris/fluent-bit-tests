service:
  log_level: info
  parsers_file: parsers.conf

pipeline:
  inputs:
    # https://docs.fluentbit.io/manual/data-pipeline/inputs/tail
    - name: tail
      path: logs/*.log
      refresh_interval: 2 # seconds
      exit_on_eof: true
      parser: logfmt
      processors:
       logs:
        # Calculate a checksum to ensure the test is CPU bound
        # The scripts' debug output also give insight into the processing
        - name: lua
          script: checksum_processor.lua
          call: add_checksum

  outputs:
    # https://docs.fluentbit.io/manual/data-pipeline/outputs/file
    - name: file
      path: fb-output
      # reduce the output file size, to avoid the test being IO bound
      format: template
      template: "{level}"
