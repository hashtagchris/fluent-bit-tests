service:
  log_level: info
  parsers_file: parsers.conf

pipeline:
  inputs:
    # https://docs.fluentbit.io/manual/data-pipeline/inputs/tail
    - name: tail
      path: logs/*.log
      buffer_chunk_size: 10MB # Reduces debug-level output, increases throughput slightly
      buffer_max_size: 10MB
      refresh_interval: 2     # seconds. This is set low so the test can detect new log files quickly
      rotate_wait: 5          # seconds. 5 is the default.
      read_from_head: true    # Start reading from the beginning of the file. Needed if the log file is present prior to starting Fluent Bit.
      threaded: true          # Enable multithreading for improved throughput
      exit_on_eof: true
      parser: logfmt
      processors:
       logs:
        # Calculate a checksum to ensure the test is CPU bound
        # The scripts' debug output also give insight into the processing
        - name: lua
          script: checksum_processor.lua
          call: add_checksum

  outputs:
    # https://docs.fluentbit.io/manual/data-pipeline/outputs/file
    - name: file
      path: fb-output
      # reduce the output file size, to avoid the test being IO bound
      format: template
      template: "{level}"
